### CI&CD

CI：Continuous Integration 持续集成
是一种软件开发实践，每次集成都通过自动化的构建（包括编译，发布，自动化测试）来验证，从而尽早地发现集成错误。

CD：Continuous Deployment 持续部署
是通过自动化的构建、测试和部署循环来快速交付高质量的产品。

### 手动部署

（1）将构建完毕的文件夹通过`xftp`传输到服务器`/usr/share/nginx/html`目录下

（2）将构建完毕的文件夹用`git`分支管理起来，推送到远程仓库，然后在`linux`服务器上拉取这部分代码

### 自动化部署(CI/CD 工具)

#### jenkins

##### 简介

Jenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能

##### 部署环境

jdk环境，Jenkins是java语言开发的，因需要jdk环境。

git/svn客户端，因一般代码是放在git/svn服务器上的，我们需要拉取代码。

maven客户端，因一般java程序是由maven工程，需要maven打包，当然也有其他打包方式，如：gradle

##### Jenkins安装

首先看jenkins中文网

1.下载安装包[jenkins.war](http://mirrors.jenkins.io/war-stable/latest/jenkins.war)；

2.在安装包根路径下，运行命令 `java -jar jenkins.war --httpPort=8080，（linux环境、Windows环境都一样）；`

3.打开浏览器进入链接 [`http://localhost:8080`](http://localhost:8080/).

4.填写初始密码，激活系统`C:\User\Administrator\.jenkins\secrets\initialAdminPassword`(在这个目录找密码)

5.进入插件安装选择（这里建议选择，推荐安装的插件，保证基本常用的功能可以使用）

6.设置初始用户和密码

7.进入系统，安装完成

##### Jenkins基本配置

**1.Configure System (系统设置)**

在系统设置这里，我们只需要设置最后面的一项，配置远程服务器地址，即我们代码最终运行的服务器地址信息，就像我们之前手动部署时使用xshell登录Linux服务器一样，当然这里是可以配置多台远程Linux服务器的，配置完成后点击保存即可，为后面我们配置自动化部署做准备

**2. Configure Global Security (全局安全配置)**

a.配置用户相关的权限

b.配置钩子程序（当用代码更新时通知）访问权限，避免报403错误。默认是勾选上了的，这里去掉勾选

**3.Global Tool Configuration (全局工具配置 )**

a.配置maven的全局settings路径

b.配置jdk

c.配置git

d.配置maven的安装路径

**4.配置必要插件**

主要是检查如下这两个插件是否已安装

　　插件1：Publish over SSH
　　插件2：Deploy to container Plugin

##### Jenkins自动化部署

大体步骤：General(基础配置)--》源码管理--》构建触发器--》构建环境--》构建--》构建后操作

1.创建一个工程

2.General(基础配置)。仅需填写标准部分，其他可不填写

3.源码管理（点击“添加”按钮添加一组git仓库的账号和密码）

4.构建触发器（任意写一个token）

http://localhost:8080/job/jenkinsSpringBootDemo/build?token=token_demo2

只要执行这个地址（在浏览器上访问改地址），该项目就会发起一次构建项目，即拉取代码打包部署操作，

在实际中，是由git服务器回调改地址，在后面讲git服务器配置时详细讲解 ，

值得注意的是，如果你是学习测试，使用的是GitHub服务，要确保你的回调地址已经试外网映射过的，即往外网可以访问

5.构建环境（无需配置）

6.构建

　到此，Jenkinds服务器配置完成，接下来我还有要配置Linux服务器和Git服务器。

##### GitHub服务器配置

在GitHub服务器上的指定项目里面配置上文中提到的回调地址（github\project\setting\webhooks）

特别注意：为了保证回调地址网可以使用，

我已经将地址：http://localhost:8080/job/jenkinsSpringBootDemo/build?token=token_demo2，

通过花生壳进行外网映射为：http://zhishidi.imwork.net/job/jenkinsSpringBootDemo/build?token=token_demo2

**到这里所有配置搞定，只需修改代码，提交到git,然后访问程序看是否生效。**

##### 测试

1.测试代码

2.提交代码到git,触发构建

3.在GitHub服务器上去看，是否已经触发

4.在Jenkins的控制台查看是否，正在构建

#### github action

**GitHub Actions**是GitHub自家的持续集成及自动化工作流服务

##### 操作过程

首先在仓库 1 的根目录下，创建 `.github/workflows/main.yml` 文件，这就是 GitHub Actions 功能的配置文件，用于告诉 GitHub 要做哪些事情，写入以下内容

```js
name: Deploy GitHub Pages
 
# 触发条件：在 push 到 master 分支后
on:
  push:
    branches:
      - master
 
# 任务
jobs:
  build-and-deploy:
    # 服务器环境：最新版 Ubuntu
    runs-on: ubuntu-latest
    steps:
      # 拉取代码
      - name: Checkout
        uses: actions/checkout@v2
        with:
          persist-credentials: false
 
      # 1、生成静态文件
      - name: Build
        run: npm install && npm run build
 
      # 2、部署到 GitHub Pages
      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          REPOSITORY_NAME: somenzz/somenzz.github.io
          BRANCH: master
          FOLDER: public
          #注意这里的 public 是仓库根目录下的 public，也就是 npm run build 生成静态资源的路径，比如有的人是 `docs/.vuepress/dist`
 
      # 3、同步到 gitee 的仓库
      - name: Sync to Gitee
        uses: wearerequired/git-mirror-action@master
        env:
          # 注意在 Settings->Secrets 配置 GITEE_RSA_PRIVATE_KEY
          SSH_PRIVATE_KEY: ${{ secrets.GITEE_RSA_PRIVATE_KEY }}
        with:
          # 注意替换为你的 GitHub 源仓库地址
          source-repo: git@github.com:somenzz/somenzz.github.io.git
          # 注意替换为你的 Gitee 目标仓库地址
          destination-repo: git@gitee.com:somenzz/somenzz.git
 
      # 4、部署到 Gitee Pages
      - name: Build Gitee Pages
        uses: yanglbme/gitee-pages-action@main
        with:
          # 注意替换为你的 Gitee 用户名
          gitee-username: somenzz
          # 注意在 Settings->Secrets 配置 GITEE_PASSWORD
          gitee-password: ${{ secrets.GITEE_PASSWORD }}
          # 注意替换为你的 Gitee 仓库，仓库名严格区分大小写，请准确填写，否则会出错
          gitee-repo: somenzz/somenzz
          # 要部署的分支，默认是 master，若是其他分支，则需要指定（指定的分支必须存在）
          branch: master
 
      # 5、部署到 somenzz.cn 服务器
      - name: rsync deployments
        uses: burnett01/rsync-deployments@4.1
        with:
          # 这里是 rsync 的参数 switches: -avzh --delete --exclude="" --include="" --filter=""
          switches: -avzh
          path: public/
          remote_path: /home/ubuntu/public/
          remote_host: somenzz.cn
          remote_port: 22
          remote_user: ubuntu
          remote_key: ${{ secrets.MY_UBUNTU_RSA_PRIVATE_KEY }}
```

on 表示触发条件

jobs 表示要做的工作

jobs 下的 step 表示要做的步骤，前一步失败，后面不会继续执行。

jobs 下的 step 下有 name、uses、with 等，表示一个 action。

name 表示 action 的名称，uses 表示使用哪个插件，with 表示传给插件的参数。

secrets.XXX 这个 XXX 表示本仓库的环境变量，配置在仓库设置里面的 secrets 菜单栏，都是加密的。


#### Azure Pipeline

#### Travis CI

#### Circle CI