#### 跨站脚本攻击（XSS攻击）

##### 原理

跨站脚本攻击(Cross Site Script为了区别于CSS简称为XSS)指的是：攻击者往Web页面里插入恶意攻击代码，当用户浏览该网页时，嵌入在Web页面的攻击代码会被执行，从而达到攻击者的特殊目的。

##### 类型

xss类型主要被分为三类，分别是：反射型、存储型和DOM型

最大的区别在于反射型XSS与DOM型XSS执行都必须依靠用户手动去触发，而存储型XSS却不需要

###### 反射型

反射型XSS也被称为非持久性XSS，是现在最容易出现的一种XSS漏洞

当用户访问一个带有XSS代码的URL请求时，服务器端接收数据后进行处理，然后把带有XSS代码的数据发送到浏览器，浏览器解析这段带有XSS代码的数据后，最终造成XSS漏洞。这个过程就像一次反射，故称为反射型XSS。

非持久型XSS漏洞实际上大多数攻击数据是包含在URL中的

######  **存储型**

存储型XSS又被称为持久性XSS，存储型XSS是最危险的一种跨站脚本

允许用户存储数据的Web页面都可能会出现存储型XSS漏洞，当攻击者提交一段XSS代码后，被服务器端接收并存储，当攻击者再次访问某个页面时，这段XSS代码被服务器读出来响应给浏览器，造成XSS跨站攻击。
比如我在某个论坛发帖的时候，论坛没有对传入的HTML作处理，那么我就可以发一个帖子内容包含<script>[code]</script>的帖子,然后就守株待兔地等着来看帖子的人执行恶意脚本了。
持久型XSS漏洞是把恶意脚本存储到了数据库，访问页面的时候服务器再返回给web页面，这就是存储型XSS。

###### **DOM型**



##### 例子

用户提交的数据未经处理，直接注入到动态页面中

（1）用户在留言板输入文本

（2）用户输入账号密码

##### 危害

1、盗取各类用户帐号，如机器登录帐号、用户网银帐号、各类管理员帐号

2、控制企业数据，包括读取、篡改、添加、删除企业敏感数据的能力

3、盗窃企业重要的具有商业价值的资料

4、非法转账

5、强制发送电子邮件

6、网站挂马

7、控制受害者机器向其它网站发起攻击

##### 防范

XSS攻击其核心都是利用了脚本注入
因此我们解决办法其实很简单，不直接使用用户的输入

（1）特殊字符如”<”,”>”进行转义

（2）移除用户输入的Style节点、Script节点、Iframe节点

（3）HTML Entity 编码

（4）将重要的cookie 设置成http only 这样就不能通过js获取到该cookie了

许多 XSS 攻击的目的就是为了获取用户的 cookie，将重要的 cookie 标记为 http only，这样的话当浏览器向服务端发起请求时就会带上 cookie 字段，但是在脚本中却不能访问 cookie，这样就避免了 XSS 攻击利用 js 的 document.cookie获取 Cookie

#### 跨站请求伪造(CSRF攻击)

##### 原理

CSRF(Cross Site Request Forgery)，即跨站请求伪造，是一种常见的Web攻击。
攻击者盗用了用户的身份，以用户的名义发送恶意请求

##### 例子

受害者登录网站A，输入个人信息，在本地保存服务器生成的cookie。

然后在A网站点击由攻击者构建一条恶意链接跳转到B网站，然后A网站携带着的用户cookie信息去访问B网站。

让A网站造成是用户自己访问的假相，从而来进行一些列的操作

要完成一次CSRF攻击，被攻击的网站必须满足两个必要的条件：

（1）登录受信任网站A，并在本地生成Cookie

（2）在不登出A的情况下，访问危险网站B

常见的就是转账，发送邮件、发消息，盗取你的账号，添加系统管理员，甚至于购买商品、虚拟货币转账等。

##### 危害

通过基于受信任的输入form和对特定行为无需授权并且已认证的用户来执行某些行为的web应用。

已经通过被保存在用户浏览器中的cookie进行认证的用户将在完全无知的情况下发送HTTP请求到那个信任他的站点，进而进行用户不愿做的行为。

##### 防范

（1）使用token

服务器发送给客户端一个token，客户端提交表单时带上该token，服务器验证token是否有效，有效就允许访问，否则拒绝访问。

（2）Referer 验证

Referer 指的是页面请求来源，意思是，只接受本站的请求，服务器才做响应；如果不是，就拦截。

（3）在 HTTP 头中自定义属性并验证

#### ***SQL注入攻击***

##### 原理

SQL注入(SQL Injection)，应用程序在向后台数据库传递SQL时，攻击者将SQL命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。

在编写SQL语句时，如果直接将用户传入的数据作为参数使用字符串拼接的方式插入到SQL查询中，那么攻击者可以通过注入其他语句来执行攻击操作，这些攻击包括可以通过SQL语句做的任何事：获取敏感数据、修改数据、删除数据库表等

##### 危害

得到管理员权限

##### 防范：

1、增加黑名单或者白名单验证
 白名单验证一般指，检查用户输入是否是符合预期的类型、长度、数值范围或者其他格式标准。
黑名单验证是指，若在用户输入中，包含明显的恶意内容则拒绝该条用户请求。
在使用白名单验证时，一般会配合黑名单验证。

2、安全检测
 在项目完成的时候，始终坚持安全检测。

3、防止系统敏感信息泄露
 对数据表的访问权限进行严格控制，尽量限制用户不必要的访问权限

#### 文件上传漏洞

##### 原理：

由于文件上传功能实现代码没有严格限制用户上传的文件后缀以及文件类型，导致允许攻击者向某个可通过 Web 访问的目录上传任意后台文件，并能够将这些文件传递给解释器，就可以在远程服务器上执行任意后台脚本。

##### 防范：

1、检查服务器是否判断了上传文件类型及后缀。
 2、定义上传文件类型白名单，即只允许白名单里面类型的文件上传。
 3、文件上传目录禁止执行脚本解析，避免攻击者进行二次攻击。









